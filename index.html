<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>index</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="F# DSL and runtime for Storm topologies"/>
    <meta name="author" content="Eugene Tolmachev"/>

    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet"/>

    <link type="text/css" rel="stylesheet" href="https://FsStorm.github.io/FsShelter/content/style.css" />
    <link rel="icon"
            type="image/png"
            href="https://FsStorm.github.io/FsShelter/img/logo.png" />
    <script type="text/javascript" src="https://FsStorm.github.io/FsShelter/content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://fsharp.org">fsharp.org</a></li>
          <li><a href="http://github.com/FsStorm/FsShelter">github page</a></li>
        </ul>
        <h3 class="muted"><a href="https://FsStorm.github.io/FsShelter/index.html">FsShelter</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h2><a name="Overview" class="anchor" href="#Overview">Overview</a></h2>
<p>FsShelter is a library that lets you implement <a href="https://storm.apache.org/">Apache Storm</a> components and topologies in F#.
FsShelter is a major rewrite of <a href="https://github.com/FsStorm">FsStorm</a>. It departs from FsStorm in significant ways and therefore has been split into its own project.</p>
<p>Overall, the library provides a "batteries included" experience with wrappers for the Nimbus API as well as support for packaging and exporting:</p>
<ul>
<li>Bundle and submit a topology for execution without needing JDK or Storm CLI</li>
<li>Includes Storm-side serializer</li>
<li>Kill a running topology</li>
<li>Generate a topology graph as part of your build</li>
</ul>
<p>The topology and the components can be implemented in a single EXE project and are executed by Storm via its <a href="https://storm.apache.org/documentation/Multilang-protocol.html">multilang</a> protocol as separate processes - one for each task/instance.
The corresponding <a href="https://github.com/FsStorm/protoshell">ProtoShell</a> Storm-side library facilitates Protobuf serialization, which improves the throughput of FsShelter topologies as compared to default JSON.
See samples to learn how to bundle the assemblies and a serializer for upload to Storm.</p>
<p>Bring your own, if you need it:</p>
<ul>
<li>command line parser</li>
<li>logging</li>
<li>custom serializer</li>
</ul>
<h2><a name="Migrating-to-FsShelter-2-0" class="anchor" href="#Migrating-to-FsShelter-2-0">Migrating to FsShelter 2.0</a></h2>
<p>The largest change in this release is the switch to synchronous signatures for spout and bolt functions.
Primarily, this was driven by the need to reduce the footprint of self-hosting, but also by a realization that things like back-pressure are much easier to implement correctly using synchronous primitives. Asynchrony can be easily added where needed at the topology level.
Other breaking changes are:</p>
<ul>
<li>Statically-typed configuration (for a small subset of properties we use all the time)</li>
<li>Modularized <code>Bolt</code> and <code>Spout</code> DSL</li>
<li>Activate/Deactivate implementation for spouts</li>
</ul>
<p>Activation is now handled implicitly - the dispatcher will wait for an activation command before constructing the arguments for the spout function.
Deactivation is now an explicit argument into the spout DSL - use <code>ignore</code> if you don't have any deactivation semantics to implement.</p>
<h2><a name="FsShelter-topology-schema" class="anchor" href="#FsShelter-topology-schema">FsShelter topology schema</a></h2>
<p>While Storm tuples are dynamically typed, and to a large extent the types are transparent to Storm itself, they are not type-less.
Mistakes and inconsistencies between declared outputs and tuple consumers could easily lead to errors detectable at run-time only and may be frustrating to test, detect and fix.
FsShelter introduces the concept of a topology schema, defined as an F# discriminated union:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs3', 3)" onmouseover="showTip(event, 'fs3', 3)" class="t">BasicSchema</span> <span class="o">=</span> 
    | <span onmouseout="hideTip(event, 'fs3', 4)" onmouseover="showTip(event, 'fs3', 4)" class="p">Original</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs3', 5)" onmouseover="showTip(event, 'fs3', 5)" class="t">int</span>
    | <span onmouseout="hideTip(event, 'fs3', 6)" onmouseover="showTip(event, 'fs3', 6)" class="p">Incremented</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs3', 7)" onmouseover="showTip(event, 'fs3', 7)" class="t">int</span>
</code></pre></td>
</tr>
</table>
<p>Every DU case becomes a distinct stream in the topology. The fields of each DU case will become tuple fields in Storm streams.</p>
<p>It is often handy to define a type that's shared across streams, and FsShelter supports defining cases with records:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs3', 8)" onmouseover="showTip(event, 'fs3', 8)" class="t">Number</span> <span class="o">=</span> { <span onmouseout="hideTip(event, 'fs4', 9)" onmouseover="showTip(event, 'fs4', 9)" class="i">X</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs3', 10)" onmouseover="showTip(event, 'fs3', 10)" class="t">int</span>; <span onmouseout="hideTip(event, 'fs3', 11)" onmouseover="showTip(event, 'fs3', 11)" class="i">Desc</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs3', 12)" onmouseover="showTip(event, 'fs3', 12)" class="t">string</span> }

<span class="k">type</span> <span onmouseout="hideTip(event, 'fs3', 13)" onmouseover="showTip(event, 'fs3', 13)" class="t">RecordSchema</span> <span class="o">=</span> 
    | <span onmouseout="hideTip(event, 'fs3', 14)" onmouseover="showTip(event, 'fs3', 14)" class="p">Original</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs3', 15)" onmouseover="showTip(event, 'fs3', 15)" class="t">int</span>
    | <span onmouseout="hideTip(event, 'fs3', 16)" onmouseover="showTip(event, 'fs3', 16)" class="p">Described</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs3', 17)" onmouseover="showTip(event, 'fs3', 17)" class="t">Number</span>
    | <span onmouseout="hideTip(event, 'fs3', 18)" onmouseover="showTip(event, 'fs3', 18)" class="p">Translated</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs3', 19)" onmouseover="showTip(event, 'fs3', 19)" class="t">Number</span>
</code></pre></td>
</tr>
</table>
<p>It is also common to join/zip tuples from multiple streams, and FsShelter supports defining cases with records adjoined:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs3', 20)" onmouseover="showTip(event, 'fs3', 20)" class="t">RecordsSchema</span> <span class="o">=</span> 
    | <span onmouseout="hideTip(event, 'fs3', 21)" onmouseover="showTip(event, 'fs3', 21)" class="p">Original</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs3', 22)" onmouseover="showTip(event, 'fs3', 22)" class="t">Number</span>
    | <span onmouseout="hideTip(event, 'fs3', 23)" onmouseover="showTip(event, 'fs3', 23)" class="p">Doubled</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs3', 24)" onmouseover="showTip(event, 'fs3', 24)" class="t">Number</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs3', 25)" onmouseover="showTip(event, 'fs3', 25)" class="t">Number</span>
</code></pre></td>
</tr>
</table>
<p>Other than the safety of working with a statically-verified schema, the reason we care about the structure of the tuples is because we reference them in Storm grouping definitions.
FsShelter "flattens" the first immediate "layer" of the DU case so that all the fields, weither they come from the embedded record or the DU case itself, are available for grouping expressions.</p>
<p>Generic or nested schemas are also supported. For example:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs3', 26)" onmouseover="showTip(event, 'fs3', 26)" class="i">BasicSchema</span> <span class="o">=</span> 
    | <span onmouseout="hideTip(event, 'fs3', 27)" onmouseover="showTip(event, 'fs3', 27)" class="i">Original</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs3', 28)" onmouseover="showTip(event, 'fs3', 28)" class="i">int</span>
    | <span onmouseout="hideTip(event, 'fs3', 29)" onmouseover="showTip(event, 'fs3', 29)" class="i">Incremented</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs3', 30)" onmouseover="showTip(event, 'fs3', 30)" class="i">int</span>

<span class="k">type</span> <span onmouseout="hideTip(event, 'fs3', 31)" onmouseover="showTip(event, 'fs3', 31)" class="t">NestedSchema</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">a</span><span class="o">&gt;</span> <span class="o">=</span> 
    | <span onmouseout="hideTip(event, 'fs3', 32)" onmouseover="showTip(event, 'fs3', 32)" class="p">Named</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs3', 33)" onmouseover="showTip(event, 'fs3', 33)" class="t">string</span>
    | <span onmouseout="hideTip(event, 'fs3', 34)" onmouseover="showTip(event, 'fs3', 34)" class="p">Nested</span> <span class="k">of</span> <span class="o">&#39;</span><span class="i">a</span>
    
</code></pre></td>
</tr>
</table>
<p>where a topology can be defined with the signature: <code>Topology&lt;NestedSchema&lt;BasicSchema&gt;&gt;</code>.
This can be useful for implementing a base topology and extending it using a nested set of streams. Nested streams can be grouped on by adding the <code>NestedStreamAttribute</code> to the <code>Nested</code> case. Without this attribute, nested streams will be treated as blobs.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs3', 35)" onmouseover="showTip(event, 'fs3', 35)" class="i">NestedSchema</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">a</span><span class="o">&gt;</span> <span class="o">=</span> 
    | <span onmouseout="hideTip(event, 'fs3', 36)" onmouseover="showTip(event, 'fs3', 36)" class="i">Named</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs3', 37)" onmouseover="showTip(event, 'fs3', 37)" class="i">string</span>
    | [&lt;<span onmouseout="hideTip(event, 'fs3', 38)" onmouseover="showTip(event, 'fs3', 38)" class="i">NestedStream</span>&gt;] <span onmouseout="hideTip(event, 'fs3', 39)" onmouseover="showTip(event, 'fs3', 39)" class="i">Nested</span> <span class="k">of</span> <span class="o">&#39;</span><span onmouseout="hideTip(event, 'fs3', 40)" onmouseover="showTip(event, 'fs3', 40)" class="i">a</span>
</code></pre></td>
</tr>
</table>
<h2><a name="FsShelter-components" class="anchor" href="#FsShelter-components">FsShelter components</a></h2>
<p>Some of the flexibility of Storm has been hidden to provide a simple developer experience for authoring event-driven solutions.
For exmple, FsShelter components are implemeted as simple functions:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// numbers spout - produces messages</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs3', 41)" onmouseover="showTip(event, 'fs3', 41)" class="f">numbers</span> <span onmouseout="hideTip(event, 'fs3', 42)" onmouseover="showTip(event, 'fs3', 42)" class="i">source</span> <span class="o">=</span> <span class="k">return</span> <span onmouseout="hideTip(event, 'fs3', 43)" onmouseover="showTip(event, 'fs3', 43)" class="i">Some</span>(<span onmouseout="hideTip(event, 'fs3', 44)" onmouseover="showTip(event, 'fs3', 44)" class="i">Original</span>(<span onmouseout="hideTip(event, 'fs3', 45)" onmouseover="showTip(event, 'fs3', 45)" class="i">source</span>()))
</code></pre></td>
</tr>
</table>
<p>The async body of a spout is expected to return an option if there's a tuple to emit or None if there's nothing to emit at this time.</p>
<p>Bolts can get a tuple on any number of streams, and so we pattern match:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// add 1 bolt - consumes and emits messages to Incremented stream</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs3', 46)" onmouseover="showTip(event, 'fs3', 46)" class="f">addOne</span> (<span onmouseout="hideTip(event, 'fs3', 47)" onmouseover="showTip(event, 'fs3', 47)" class="i">input</span>, <span onmouseout="hideTip(event, 'fs3', 48)" onmouseover="showTip(event, 'fs3', 48)" class="f">emit</span>) <span class="o">=</span> 
    <span class="k">match</span> <span onmouseout="hideTip(event, 'fs3', 49)" onmouseover="showTip(event, 'fs3', 49)" class="i">input</span> <span class="k">with</span>
    | <span onmouseout="hideTip(event, 'fs3', 50)" onmouseover="showTip(event, 'fs3', 50)" class="t">BasicSchema</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs5', 51)" onmouseover="showTip(event, 'fs5', 51)" class="p">Original</span>(<span onmouseout="hideTip(event, 'fs6', 52)" onmouseover="showTip(event, 'fs6', 52)" class="i">x</span>) <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs3', 53)" onmouseover="showTip(event, 'fs3', 53)" class="p">Incremented</span>(<span onmouseout="hideTip(event, 'fs6', 54)" onmouseover="showTip(event, 'fs6', 54)" class="i">x</span> <span class="o">+</span> <span class="n">1</span>)
    | _ <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs3', 55)" onmouseover="showTip(event, 'fs3', 55)" class="f">failwithf</span> <span class="s">&quot;unexpected input: </span><span class="pf">%A</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs3', 56)" onmouseover="showTip(event, 'fs3', 56)" class="i">input</span>
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs3', 57)" onmouseover="showTip(event, 'fs3', 57)" class="f">emit</span>
</code></pre></td>
</tr>
</table>
<p>The bolt can also emit at any time, and we can hold on to the passed-in <code>emit</code> function (with caveats).
Also, there can be as many arguments for the component functions as needed; the specifics will be determined when the components are put together in a topology.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// terminating bolt - consumes messages</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs3', 58)" onmouseover="showTip(event, 'fs3', 58)" class="f">logResult</span> (<span onmouseout="hideTip(event, 'fs3', 59)" onmouseover="showTip(event, 'fs3', 59)" class="f">info</span>, <span onmouseout="hideTip(event, 'fs3', 60)" onmouseover="showTip(event, 'fs3', 60)" class="i">input</span>) <span class="o">=</span> 
    <span class="k">match</span> <span onmouseout="hideTip(event, 'fs3', 61)" onmouseover="showTip(event, 'fs3', 61)" class="i">input</span> <span class="k">with</span>
    | <span onmouseout="hideTip(event, 'fs3', 62)" onmouseover="showTip(event, 'fs3', 62)" class="t">BasicSchema</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs7', 63)" onmouseover="showTip(event, 'fs7', 63)" class="p">Incremented</span>(<span onmouseout="hideTip(event, 'fs6', 64)" onmouseover="showTip(event, 'fs6', 64)" class="i">x</span>) <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs3', 65)" onmouseover="showTip(event, 'fs3', 65)" class="f">info</span> (<span onmouseout="hideTip(event, 'fs3', 66)" onmouseover="showTip(event, 'fs3', 66)" class="f">sprintf</span> <span class="s">&quot;</span><span class="pf">%A</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs6', 67)" onmouseover="showTip(event, 'fs6', 67)" class="i">x</span>)
    | _ <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs3', 68)" onmouseover="showTip(event, 'fs3', 68)" class="f">failwithf</span> <span class="s">&quot;unexpected input: </span><span class="pf">%A</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs3', 69)" onmouseover="showTip(event, 'fs3', 69)" class="i">input</span>
</code></pre></td>
</tr>
</table>
<h2><a name="Using-F-DSL-to-define-the-topology" class="anchor" href="#Using-F-DSL-to-define-the-topology">Using F# DSL to define the topology</a></h2>
<p>Storm topology is a graph of spouts and bolts connected via streams. FsShelter provides an embedded DSL for defining the topologies, which allows for mixing and matching of native Java, external shell, and FsShelter components:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// define our source dependency</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs3', 70)" onmouseover="showTip(event, 'fs3', 70)" class="f">source</span> <span class="o">=</span> 
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs3', 71)" onmouseover="showTip(event, 'fs3', 71)" class="i">rnd</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs3', 72)" onmouseover="showTip(event, 'fs3', 72)" class="t">Random</span>()
    <span class="k">fun</span> () <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs3', 73)" onmouseover="showTip(event, 'fs3', 73)" class="i">rnd</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs8', 74)" onmouseover="showTip(event, 'fs8', 74)" class="f">Next</span>(<span class="n">0</span>, <span class="n">100</span>)

<span class="k">open</span> <span onmouseout="hideTip(event, 'fs3', 75)" onmouseover="showTip(event, 'fs3', 75)" class="i">FsShelter</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs9', 76)" onmouseover="showTip(event, 'fs9', 76)" class="i">DSL</span>
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs3', 77)" onmouseover="showTip(event, 'fs3', 77)" class="i">FsShelter</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs10', 78)" onmouseover="showTip(event, 'fs10', 78)" class="i">Multilang</span>

<span class="c">//define the Storm topology</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs3', 79)" onmouseover="showTip(event, 'fs3', 79)" class="i">sampleTopology</span> <span class="o">=</span> 
    <span onmouseout="hideTip(event, 'fs3', 80)" onmouseover="showTip(event, 'fs3', 80)" class="f">topology</span> <span class="s">&quot;Sample&quot;</span> { 
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs3', 81)" onmouseover="showTip(event, 'fs3', 81)" class="i">s1</span> <span class="o">=</span> 
            <span onmouseout="hideTip(event, 'fs3', 82)" onmouseover="showTip(event, 'fs3', 82)" class="f">numbers</span>
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs3', 83)" onmouseover="showTip(event, 'fs3', 83)" class="t">Spout</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs11', 84)" onmouseover="showTip(event, 'fs11', 84)" class="f">runUnreliable</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs3', 85)" onmouseover="showTip(event, 'fs3', 85)" class="f">log</span> <span onmouseout="hideTip(event, 'fs3', 86)" onmouseover="showTip(event, 'fs3', 86)" class="i">cfg</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs3', 87)" onmouseover="showTip(event, 'fs3', 87)" class="f">source</span>) <span class="c">// ignoring available Storm logging and cfg and passing our source function</span>
                                   <span onmouseout="hideTip(event, 'fs3', 88)" onmouseover="showTip(event, 'fs3', 88)" class="f">ignore</span>                  <span class="c">// no deactivation</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs3', 89)" onmouseover="showTip(event, 'fs3', 89)" class="i">b1</span> <span class="o">=</span> 
            <span onmouseout="hideTip(event, 'fs3', 90)" onmouseover="showTip(event, 'fs3', 90)" class="f">addOne</span>
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs3', 91)" onmouseover="showTip(event, 'fs3', 91)" class="t">Bolt</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs12', 92)" onmouseover="showTip(event, 'fs12', 92)" class="f">run</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs3', 93)" onmouseover="showTip(event, 'fs3', 93)" class="f">log</span> <span onmouseout="hideTip(event, 'fs3', 94)" onmouseover="showTip(event, 'fs3', 94)" class="i">cfg</span> <span onmouseout="hideTip(event, 'fs3', 95)" onmouseover="showTip(event, 'fs3', 95)" class="i">tuple</span> <span onmouseout="hideTip(event, 'fs3', 96)" onmouseover="showTip(event, 'fs3', 96)" class="f">emit</span> <span class="k">-&gt;</span> (<span onmouseout="hideTip(event, 'fs3', 97)" onmouseover="showTip(event, 'fs3', 97)" class="i">tuple</span>, <span onmouseout="hideTip(event, 'fs3', 98)" onmouseover="showTip(event, 'fs3', 98)" class="f">emit</span>)) <span class="c">// pass incoming tuple and emit function</span>
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs3', 99)" onmouseover="showTip(event, 'fs3', 99)" class="f">withParallelism</span> <span class="n">2</span> <span class="c">// override default parallelism of 1</span>
        
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs3', 100)" onmouseover="showTip(event, 'fs3', 100)" class="i">b2</span> <span class="o">=</span> 
            <span onmouseout="hideTip(event, 'fs3', 101)" onmouseover="showTip(event, 'fs3', 101)" class="f">logResult</span>
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs3', 102)" onmouseover="showTip(event, 'fs3', 102)" class="t">Bolt</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs12', 103)" onmouseover="showTip(event, 'fs12', 103)" class="f">run</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs3', 104)" onmouseover="showTip(event, 'fs3', 104)" class="f">log</span> <span onmouseout="hideTip(event, 'fs3', 105)" onmouseover="showTip(event, 'fs3', 105)" class="i">cfg</span> <span onmouseout="hideTip(event, 'fs3', 106)" onmouseover="showTip(event, 'fs3', 106)" class="i">tuple</span> <span onmouseout="hideTip(event, 'fs3', 107)" onmouseover="showTip(event, 'fs3', 107)" class="f">emit</span> <span class="k">-&gt;</span> ((<span onmouseout="hideTip(event, 'fs3', 108)" onmouseover="showTip(event, 'fs3', 108)" class="f">log</span> <span onmouseout="hideTip(event, 'fs3', 109)" onmouseover="showTip(event, 'fs3', 109)" class="i">LogLevel</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs3', 110)" onmouseover="showTip(event, 'fs3', 110)" class="i">Info</span>), <span onmouseout="hideTip(event, 'fs3', 111)" onmouseover="showTip(event, 'fs3', 111)" class="i">tuple</span>)) <span class="c">// example of passing Info-level Storm logger into the bolt</span>
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs3', 112)" onmouseover="showTip(event, 'fs3', 112)" class="f">withParallelism</span> <span class="n">2</span>
        
        <span class="k">yield</span> <span onmouseout="hideTip(event, 'fs3', 113)" onmouseover="showTip(event, 'fs3', 113)" class="i">s1</span> <span class="o">--&gt;</span> <span onmouseout="hideTip(event, 'fs3', 114)" onmouseover="showTip(event, 'fs3', 114)" class="i">b1</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs3', 115)" onmouseover="showTip(event, 'fs3', 115)" class="t">Shuffle</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs13', 116)" onmouseover="showTip(event, 'fs13', 116)" class="f">on</span> <span onmouseout="hideTip(event, 'fs3', 117)" onmouseover="showTip(event, 'fs3', 117)" class="t">BasicSchema</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs5', 118)" onmouseover="showTip(event, 'fs5', 118)" class="p">Original</span> <span class="c">// emit from s1 to b1 on Original stream</span>
        <span class="k">yield</span> <span onmouseout="hideTip(event, 'fs3', 119)" onmouseover="showTip(event, 'fs3', 119)" class="i">b1</span> <span class="o">--&gt;</span> <span onmouseout="hideTip(event, 'fs3', 120)" onmouseover="showTip(event, 'fs3', 120)" class="i">b2</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs3', 121)" onmouseover="showTip(event, 'fs3', 121)" class="t">Shuffle</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs13', 122)" onmouseover="showTip(event, 'fs13', 122)" class="f">on</span> <span onmouseout="hideTip(event, 'fs3', 123)" onmouseover="showTip(event, 'fs3', 123)" class="p">Incremented</span> <span class="c">// emit from b1 to b2 on Incremented stream</span>
    }
</code></pre></td>
</tr>
</table>
<p>Storm will start (a copy of) the same EXE for every component instance in the topology and will assign each instance a task it supposed to execute.</p>
<p>The topology can be packaged with all its dependecies and submitted using the embedded Nimbus client; see the examples for details.</p>
<h2><a name="Exporting-the-topology-graph-in-DOT-format-GraphViz-using-F-scripts" class="anchor" href="#Exporting-the-topology-graph-in-DOT-format-GraphViz-using-F-scripts">Exporting the topology graph in DOT format (GraphViz) using F# scripts</a></h2>
<p>Once the number of components grows beyond a trivial number, it is often handy to be able to visualize them. FsShelter includes a simple way to export the topology into a graph:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs3', 124)" onmouseover="showTip(event, 'fs3', 124)" class="i">sampleTopology</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs3', 125)" onmouseover="showTip(event, 'fs3', 125)" class="t">DotGraph</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs14', 126)" onmouseover="showTip(event, 'fs14', 126)" class="f">writeToConsole</span>
</code></pre></td>
</tr>
</table>
<p>See the samples included for further details.</p>
<h2><a name="Samples-amp-documentation" class="anchor" href="#Samples-amp-documentation">Samples &amp; documentation</a></h2>
<ul>
<li><p><a href="wordcount.html">WordCount</a> contains an "unreliable" spout example - emitted tuples do not require ack, and could be lost in case of failure.</p></li>
<li><p><a href="guaranteed.html">Guaranteed</a> contains a "reliable" spout example - emitted tuples have a unique ID and require ack.</p></li>
<li>
<p><a href="reference/index.html">API Reference</a> contains automatically generated documentation for public types, modules
and functions in the library.</p>
</li>
</ul>
<h2><a name="Getting-FsShelter" class="anchor" href="#Getting-FsShelter">Getting FsShelter</a></h2>
<div class="row">
  <div class="span1"></div>
  <div class="span6">
    <div class="well well-small" id="nuget">
      The FsShelter library can be installed from <a href="https://nuget.org/packages/FsShelter">NuGet</a> or <a href="https://www.myget.org/F/FsShelter/">MyGet</a>:
      <pre>PM> Install-Package FsShelter</pre>
    </div>
  </div>
  <div class="span1"></div>
</div>
<div class="row">
  <div class="span1"></div>
  <div class="span6">
    <div class="well well-small">
      The library can also be tried out quickly as a Docker container, downloaded from <a href="https://hub.docker.com/r/FsStorm/fsshelter-samples/">docker hub</a>:
      <pre>$ docker run --name fsshelter-samples -d -p 8080:8080 FsStorm/fsshelter-samples</pre>
    </div>
  </div>
  <div class="span1"></div>
</div>
<h2><a name="Contributing-and-copyright" class="anchor" href="#Contributing-and-copyright">Contributing and copyright</a></h2>
<p>The project is hosted on <a href="https://github.com/FsStorm/FsShelter">GitHub</a> where you can <a href="https://github.com/FsStorm/FsShelter/issues">report issues</a>, fork
the project and submit pull requests. If you're adding a new public API, please also
consider adding <a href="https://github.com/FsStorm/FsShelter/tree/master/docs/content">samples</a> that can be turned into a documentation. You might
also want to read the <a href="https://github.com/FsStorm/FsShelter/blob/master/README.md">library design notes</a> to understand how it works.</p>
<p>The library is available under Apache 2.0 license, which allows modification and
redistribution for both commercial and non-commercial purposes. For more information see the
<a href="https://github.com/FsStorm/FsShelter/blob/master/LICENSE.md">License file</a> in the GitHub repository.</p>
<h2><a name="Commercial-support" class="anchor" href="#Commercial-support">Commercial support</a></h2>
<p>Commercial training and support are available from the project sponsor:
<a href="http://FsStorm.ca/" target="_blank"><img src="http://FsStorm.ca/wp-content/uploads/2014/06/Logo-.jpg" alt="FsStorm" style="height:30px" border="0" /></a></p>

<div class="tip" id="fs1">namespace System</div>
<div class="tip" id="fs2">namespace FsShelter</div>
<div class="tip" id="fs3"></div>
<div class="tip" id="fs4">Number.X: int</div>
<div class="tip" id="fs5">union case BasicSchema.Original: int -&gt; BasicSchema</div>
<div class="tip" id="fs6">val x : int</div>
<div class="tip" id="fs7">union case BasicSchema.Incremented: int -&gt; BasicSchema</div>
<div class="tip" id="fs8">Random.Next() : int<br />Random.Next(maxValue: int) : int<br />Random.Next(minValue: int, maxValue: int) : int</div>
<div class="tip" id="fs9">module DSL<br /><br />from FsShelter</div>
<div class="tip" id="fs10">module Multilang<br /><br />from FsShelter</div>
<div class="tip" id="fs11">val runUnreliable : mkArgs:((LogLevel -&gt; string -&gt; unit) -&gt; Conf -&gt; &#39;args) -&gt; deactivate:(&#39;args -&gt; unit) -&gt; next:Next&lt;&#39;args,&#39;t&gt; -&gt; Topology.Spout&lt;&#39;t&gt;<br /><br />Full name: FsShelter.DSL.Spout.runUnreliable</div>
<div class="tip" id="fs12">val run : mkArgs:((LogLevel -&gt; string -&gt; unit) -&gt; Conf -&gt; &#39;t -&gt; (&#39;t -&gt; unit) -&gt; &#39;a) -&gt; consume:Consume&lt;&#39;a&gt; -&gt; Topology.Bolt&lt;&#39;t&gt;<br /><br />Full name: FsShelter.DSL.Bolt.run</div>
<div class="tip" id="fs13">static member Shuffle.on : case:Quotations.Expr&lt;(&#39;a0 -&gt; &#39;t)&gt; -&gt; (bool -&gt; Topology.ComponentId -&gt; Topology.ComponentId -&gt; Topology.Stream&lt;&#39;t&gt;)</div>
<div class="tip" id="fs14">val writeToConsole : t:Topology.Topology&lt;&#39;a&gt; -&gt; unit<br /><br />Full name: FsShelter.DotGraph.writeToConsole</div>

        </div>
        <div class="span3">
          <img src="https://FsStorm.github.io/FsShelter/img/logo.png" alt="F# Project" style="width:150px;margin:10px" />  
          <ul class="nav nav-list" id="menu" style="margin-top: 20px;">
            <li class="nav-header">FsShelter</li>
            <li><a href="https://FsStorm.github.io/FsShelter/index.html">Home page</a></li>
            <li class="divider"></li>
            <li><a href="http://nuget.org/packages/FsShelter">Get Library via NuGet</a></li>
            <li><a href="http://github.com/FsStorm/FsShelter">Source Code on GitHub</a></li>
            <li><a href="https://FsStorm.github.io/FsShelter/LICENSE.html">License</a></li>
            <li><a href="https://FsStorm.github.io/FsShelter/RELEASE_NOTES.html">Release Notes</a></li>
            
            <li class="nav-header">Getting started
            <li><a href="https://FsStorm.github.io/FsShelter/wordcount.html">WordCount topology</a>
			<ul>
			<li><a href="https://FsStorm.github.io/FsShelter/wordcount.html#Defining-the-schema">Schema</a></li>
            <li><a href="https://FsStorm.github.io/FsShelter/wordcount.html#Defining-unreliable-spouts">Spout</a></li>
			<li><a href="https://FsStorm.github.io/FsShelter/wordcount.html#Defining-bolts">Bolt</a></li>
			<li><a href="https://FsStorm.github.io/FsShelter/wordcount.html#Using-F-DSL-to-define-a-topology">Topology</a></li>
			<li><a href="https://FsStorm.github.io/FsShelter/wordcount.html#Submitting-the-topology-for-execution">Submitting for execution</a></li>
            <li><a href="https://FsStorm.github.io/FsShelter/wordcount.html#Exporting-the-topology-graph">Topology graph</a></li>
			</ul>
			</li>
      <li>
          <a href="https://FsStorm.github.io/FsShelter/guaranteed.html">Guaranteed processing</a>
          <ul>
              <li><a href="https://FsStorm.github.io/FsShelter/guaranteed.html#Defining-reliable-spouts">Reliable Spout</a></li>
              <li><a href="https://FsStorm.github.io/FsShelter/guaranteed.html#Anchoring">Anchoring</a></li>
          </ul>
      <li>
          <a href="https://FsStorm.github.io/FsShelter/self-hosting.html">Self-hosting</a>
			</li>
      <li><a href="https://FsStorm.github.io/FsShelter/schema.html">Schema considerations</a></li>

            <li class="nav-header">Documentation</li>
            <li><a href="https://FsStorm.github.io/FsShelter/reference/index.html">API Reference</a></li>
          </ul>
        </div>
      </div>
    </div>
    <a href="http://github.com/FsStorm/FsShelter"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"/></a>
  </body>
  </html>
